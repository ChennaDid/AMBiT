\documentclass[a4paper,11pt]{article}

\usepackage[numbers,sort&compress]{natbib}
\usepackage{url}
\usepackage{anysize}
\usepackage[T1]{fontenc}
\usepackage{courier}
\usepackage{amsmath}

\include{phys_jdf}

\newcommand{\option}[1]{\smallskip\noindent\textbf{\texttt{#1}}}
\newcommand{\code}[1]{\texttt{#1}}
\marginsize{30mm}{25mm}{20mm}{20mm}

\begin{document}

\title{AMBiT documentation}
\author{Julian Berengut}

\maketitle

\begin{centering}

jcb@phys.unsw.edu.au

\url{http://www.phys.unsw.edu.au/~jcb/}

\end{centering}

\section{Introduction}

AMBiT is a parallel-processor implementation of the CI+MBPT (Configuration Interaction + Many-Body Perturbation Theory) method, first described in~\cite{dzuba96pra}. Briefly this requires the following course of action:
\begin{itemize}
\item Dirac-Fock (DF) for the core electrons.
\item Creation of a basis states above the core, including valence states and perhaps a large basis for MBPT.
\item Many-body perturbation theory (MBPT) calculation of core-valence correlations, and creation of modified radial integrals for the CI calculation.
\item Configuration Interaction (CI) calculation including creation of the angular coefficients and radial integrals.
\end{itemize}
Of course, the user may want to perform only part of this process. For example, a regular CI calculation, or only DF+MBPT for a single-valence electron above closed shells.

AMBiT supports two complementary methods of input: command line and input file. In any given run, both of these are concatenated and parsed together. Any input can be given by the user in either place. On the other hand, there tends to be a natural separation between the input file, which resembles a plan for all stages of the entire calculation, and command line options which tend to tell AMBiT which part of the calculation to do on this run.

\section{Installation}

Building AMBiT on a new computer system can be done by altering ``make.machine''. AMBiT requires a C++11 compiler and a fortran compiler, BLAS and LAPACK libraries, the boost library, Eigen, and google sparsehash. To run in parallel-processor mode requires MPI, and optionally SCALAPACK.

\section{Input}

AMBiT takes input from the command line and an input file. A template input file can be found in the root AMBiT directory, named template.input. In principle, all parameters can be place in either. An exception is the directive to find the input file, which \emph{must} be placed in the command line using the -f option or by including a filename ending in .input, e.g.:
\begin{quote}
\begin{verbatim}
> ambit -f myFile.txt
> ambit -f "Carbon.inp"
> ambit FeIV.input
\end{verbatim}
\end{quote}

Most input parameters are optional, and if they're not given AMBiT will make something up. If you miss something really important, AMBiT will tell you. AMBiT uses ``GetPot'' to parse input files (http://getpot.sourceforge.net/) which means that the \textbf{input is structured}. The ordering of input is not important, however where a parameter or option appears in the structure is important. For example to use a B-spline basis, the input can be given like this
\begin{quote}
\begin{verbatim}
[HF]
// Just use a closed Ar core
N = 18

[Basis]
--bspline-basis
ValenceBasis = 6spdf
[./BSpline]
N = 40
K = 7
Rmax = 50.   // These are the default values for B-spline basis
...
\end{verbatim}
\end{quote}
or (in the root of the tree structure)
\begin{quote}
\begin{verbatim}
Basis/--bspline-basis
Basis/ValenceBasis = 6spdf
HF/N = 16
Basis/BSpline/N = 40
...
\end{verbatim}
\end{quote}
which is usually messier.
Note that the input file lets you have spaces and comments (marked with `//') while any options given in the command line must not have additional spaces, e.g.:
\begin{quote}
\begin{verbatim}
> ambit FeIV.input Basis/--bspline-basis Basis/BSpline/Rmax=30.0
\end{verbatim}
\end{quote}

Lists of parameters are given as comma-separated values, enclosed in apostrophes:
\begin{quote}
\begin{verbatim}
CI/LeadingConfigurations = '3d7, 3d6 4s1, 3d6 4p1'
\end{verbatim}
\end{quote}

\newpage
\section{Options and parameters}
The following input parameters are given in their correct place in the tree structure. They are all optional unless otherwise stated.

\option{-f \emph{filename}} \textbf{[compulsory, command line]} Names the input file as \emph{filename}. If this is not present, AMBiT searches the command line for an option of the form \emph{*.input} which it assumes is the input filename. 

\option{-c, -{}-clean} Don't read from previously written basis or levels.
\option{-{}-check-sizes} Check sizes of integral files and Hamiltonian matrices, after calculating or reading one of the core+basis sets. Note that this command also calculates any angular data that is not already available, and so it can be slow the first time it is run for a CI problem with many valence electrons.

\option{-h, -{}-help} Print usage message.

\option{-p, -{}-print-basis} Write out the basis as a Grasp0 ``MCDF.DMP'' file.

\option{-r} select a subset of the possible runs for this run. Used when there are multiple runs. e.g.~\texttt{-r='1,2'} means just run the first two. \texttt{-r=0} is a special case which only runs the case where the varying parameter equals zero. For example if the input file contains

\begin{quote}
\begin{verbatim}
AlphaSquaredVariation = '-0.2, -0.1, 0.0, 0.1, 0.2'
\end{verbatim}
\end{quote}
then \texttt{-r=0} is equivalent to selecting the third case with \texttt{-r=3}.

\option{-{}-version} Print version information only.

%\option{-{}-interactive} Enable interactive mode at the end of a singular run. This will cause AMBiT to wait for input after completing all calculations so that the results can be further manipulated within the program.
%\option{-{}-recursive-build} Sets AMBiT to run in recursive mode to build all atoms with a given charge, iterating from a starting value of N and progressively adding electrons in the next lowest orbital until a final N is reached.
\option{-{}-write-hamiltonian} Write Hamiltonian matrices to binary file (that can be read into Mathematica using AMBiT.m). Filename is \code{ID.<twoJ>.<Parity>.matrix}.

\option{-{}-ci-complete} Only for use with \code{CI/-{}-memory-saver}. Don't calculate energy levels using CI (assume that they have been calculated already).

\option{-{}-no-ci} Option for use particularly when running single-valence-electron (e.g. alkali) atoms to not calculate CI energy levels.

\option{-{}-configuration-average} Use configuration average for energy levels, transitions, autoionization rates, etc.

\option{Z} \textbf{[compulsory]} nuclear charge.

%\option{[deprecated] ZIterations} This is used when NumValenceElectrons = 1. It specifies the number of times to increment Z and recalculate the energy levels before terminating.

\option{ID} a name for the run, used for filenames when saving various stages of the calculation. If not present identity is taken from the prefix of the ``*.input'' file. If this cannot be found (for example if the input file name does not have this suffix) then a fatal error is issued.

%\option{[deprecated] NumValenceElectrons} \textbf{[compulsory]} AMBiT knows what kind of calculation to do from the number of valence electrons. \texttt{NumValenceElectrons = 1} is used for HF+MBPT calculations; otherwise \textbf{NumValenceElectrons} tells AMBiT how many valence electrons will be included in the CI calculation.

\option{NuclearRadius} nuclear radius in fermi. The nucleus is specified as a fermi surface with a radius and thickness parameter.

\option{NuclearThickness} nuclear thickness. Set to zero for hard-core nucleus.

\option{AngularDataDirectory} specify directory where angular data is stored and retrieved (from default set by make.machine).

\option{LevelDirectory} [.] specify directory where levels are stored.

% Lattice
\subsection{[Lattice]}
Default is a lattice that starts exponential at small $r$ and then becomes constant spacing at larger $r$. The relevant formula is $x = r + \beta*\ln(r/r_{min})$ where $x$ is a lattice with constant spacing $H$.

\option{NumPoints} [1000] number of points in lattice. This may be increased by AMBiT as necessary.

\option{StartPoint} [1.e-6] first point in lattice (non-zero).

\option{EndPoint} [50.] last point in lattice (size in real space).

\option{-{}-exp-lattice} use pure exponential lattice instead: $r = r_{min}\exp(x)$ where $x$ is a lattice with constant spacing $H$. Defaults become NumPoints = 300 and StartPoint = 1.e-5 to correspond to a typical Grasp0 lattice.

\option{H} [0.05] spacing of regular lattice $x$ (only used with \texttt{-{}-exp-lattice}).

% HF
\subsection{[HF]: Relativistic Hartree-Fock options for building core.}

\option{N} \textbf{[compulsory]} number of electrons included in HF procedure. In recursive building mode, this instead specifies the number of electrons the initial atom should have.

\option{Charge} can be used instead of HF/N: Charge = Z - N.

\option{Configuration} string indicating non-relativistic structure of HF core (possibly including open shells), e.g.~\texttt{HF/Configuration = '1s2 2s2 2p6 3s2 3p6: 3d4'}. A colon may be used to indicate the Fermi level, or omitted in which case the Fermi level is assumed to lie just after all orbitals. The Fermi level is used to define the CI model space (and the MBPT electron space).

\option{-{}-breit} Include Breit interaction in HF operator.

\option{-{}-local-exchange} Use local exchange approximation $x_\alpha \left(\frac{81}{32\pi^2} \frac{\rho(r)}{r^2}\right)^{1/3}$, where $\rho(r)$ is the electron density. The value $x_\alpha$ can be set using \code{HF/Xalpha} [default = 1.0].

\option{-{}-read-grasp0} Read core and excited states from Grasp0 ``MCDF.DAT'' file rather than generating it or reading from an AMBiT ``[ID].core.atom'' file.

\option{AddLocalPotential/Filename} Import a potential from a file. Imported file should be a text list of radial points and corresponding potentials: $R \quad V(R)$, with one point per line. The imported potential is interpolated onto the lattice.

\option{AddLocalPotential/Scale} [1.0] Scale the imported potential.

%Basis
\subsection{[Basis]: Details of electron orbital construction.}
One of the basis options must be specified.

\option{ValenceBasis} \textbf{[compulsory]} set of orbitals to include in CI (if \mbox{\texttt{NumValenceElectrons}$>1$}) or HF/MBPT. This is specified by the largest principal quantum number followed by angular momenta. For example:
\texttt{6spd5f} = 1s -- 6s, 2p -- 6p, 3d -- 6d, 4f -- 5f.

\option{FrozenCore} set of orbitals that form the frozen core, which is always occupied in the CI model space. No holes are allowed at this level or below, they only exist above the frozen core and below the fermi level (which is set in HF/Configuration).

\option{-{}-bspline-basis} construct basis from B-splines~\cite{johnson88pra}.

\option{BSpline/N} [40] number of splines.

\option{BSpline/K} [7]  order of splines.

\option{BSpline/Rmax} [50.0] maximum radius of splines.

\option{BSpline/SplineType} [Reno] Decides what boundary conditions to enforce to remove spurious states. Allowed types: Reno/DKB, NotreDame/Johnson, Vanderbilt

\option{BSpline/-{}-reorthogonalise} perform secondary Gram-Schmidt orthogonalisation on the final basis states after the matrix diagonalisation.

%\option{-{}-hf-basis} Use spectroscopic (relativistic Hartree-Fock) basis.
%\option{-{}-r-basis} Use $\times r$ basis where the lowest state in each wave is spectroscopic and higher energy states are created by multiplication of the previous state by the radial function and normalisation.
%\option{-{}-custom-basis} construct basis according to the prescription in \texttt{Basis/CustomFile}.
%\option{Basis/CustomFile} ['CustomBasis.txt'] the prescription used to create a customised basis when using \texttt{-{}-custom-basis}  

%MBPT
\subsection{[MBPT]: Many-body perturbation theory.}

\option{-s1, -{}-include-sigma1} create one-body core-valence correlation diagrams. These are stored in ``[ID].one.integrals''.

\option{-s2, -{}-include-sigma2} create two-body core-valence correlation diagrams. These are stored in ``[ID].two.integrals''.

\option{-s3, -{}-include-sigma3} Include effective three-body interactions in the Hamiltonian. These diagrams are calculated during construction of the Hamiltonian (as opposed to calculated beforehand and stored), and can slow down the CI process considerably.

\option{-s12} [default if running MBPT] = \texttt{-s1} + \texttt{-s2}

\option{-s123} = = \texttt{-s1} + \texttt{-s2} + \texttt{-s3}

\option{-{}-brueckner} Create $\Sigma$ matrices and use Brueckner orbitals everywhere in the calculation. More options in MBPT/Brueckner (which are ignored if \texttt{-{}-brueckner} is not switched on).

\option{Basis} must be a superset of \code{Basis/ValenceBasis} using the same format, e.g.~\code{MBPT/Basis = 24spdfg}.

\option{TwoElectronStorageLimits} defines limits on for which radial integrals MBPT is calculated. e.g.~\code{MBPT/TwoElectronStorageLimits = 7} means that one of the orbitals must have principal quantum number $n <= 7$; \code{'7, 8'} means that, in addition, one of the other orbitals must have $n <= 8$, etc. Up to four principal quantum numbers can be specified.

\option{BoxDiagramStorageLimits} same as \texttt{MBPT/TwoElectronStorageLimits} but for diagrams that violate the usual parity selection rules.

\option{Delta} [0.0] a number to add to the denominator of every MBPT diagram. Could be equal, for example, to the difference between the HF and the CI energy~\cite{kozlov99os,berengut08jpb}.

\subsubsection{[MBPT/Brueckner]}

\option{-{}-use-lower} Include matrices between upper and lower components of wavefunction ($f$ and $g$) in $\Sigma$ potential.

\option{-{}-use-lower-lower} Include lower-lower $\Sigma$ matrix (between $g$ and $g$).

\option{Scaling} List of $\kappa$s and scaling factors to apply to $\Sigma$ matrix when forming Brueckner orbitals, maximum of one for each $\kappa$.
e.g. \code{MBPT/Brueckner/Scaling = '-1, 0.827821, 1, 0.931278, -2, 0.949873'}

\option{EnergyScaling} Set scalings by orbital energy rather than a number (this prints the scaling used also). List the orbital followed by the required energy for that orbital. Energy is set in the open-core HF potential.
This option is ignored if scalings are set by \code{MBPT/Brueckner/Scaling} option.
e.g. from Cs atom:  {\code{MBPT/Brueckner/EnergyScaling = '6s, -0.143098, 6p, -0.092166, 6p+, -0.089642'}

\option{StartPoint} [4.35e-5 = 2.3 fm] Start point of $\Sigma$ matrix.

\option{EndPoint} [8.0] End point of $\Sigma$ matrix.

\option{Stride} [4] Only store every $\textsl{stride}^{th}$ lattice point of $\Sigma$.\\
Final size of $\Sigma$ matrix is (lattice[EndPoint] - lattice[StartPoint])/Stride.

%CI
\subsection{[CI]: Configuration interaction and energy level options.}

\option{-{}-all-symmetries} Calculate all possible symmetries (ignore \code{EvenParityTwoJ} and \code{OddParityTwoJ}).

\option{-{}-memory-saver} Write all levels to disk and do not store in memory when levels are not being used.

\option{-{}-single-configuration-ci} Diagonalise Hamiltonian only for each non-relativistic configuration (with no mixing between configurations).

\option{-{}-gfactors} Calculate Land\'e $g$-factors (by default this is usually on, except in the case where  \code{-{}-single-configuration-ci} is used or the \code{NumSolutions} is large).

\option{-{}-no-gfactors} Do not calculate $g$-factors.

\option{-{}-print-configuration-average-energy} Print the configuration-average energy of the selected non-relativistic configurations.

\option{LeadingConfigurations} lists all leading configurations from which to excite electrons when forming the Hamiltonian, e.g.~\texttt{CI/LeadingConfigurations = '3d7, 3d6 4s1, 3d6 4p1'} lists three leading configurations each with seven valence electrons. The number of valence electrons or holes should be equal for all leading configurations. Hole cases may be specified with negative occupations, e.g.~\code{'3d-2'} would specify two holes in the otherwise filled $3d$ shell.

\option{ElectronExcitations} [2] number of electrons to excite from leading configurations. e.g. default 2 corresponds to SD-CI.

\option{HoleExcitations} [0] number of holes to excite from leading configurations.

\option{ExtraConfigurations} list any additional configurations here. No additional configurations formed by excitations of electrons or holes from these configurations will be included.

\option{ConfigurationAverageEnergyRange} list of two numbers that optionally limit set of non-relativistic configurations so that their configuration-average energy (in atomic units) lies within the range. e.g.~\code{CI/ConfigurationAverageEnergyRange = '-100., -99.'}.

\option{EvenParityTwoJ} list of angular momenta of even parity to create Hamiltonians and serve. e.g.~\texttt{CI/EvenParityTwoJ = '0, 2, 4, 6, 8, 10, 12'} does all even parity levels from J = 0 to 6.

\option{OddParityTwoJ} list of angular momenta calculations to do for odd parity states.

\option{MaxEnergy} AMBiT calculates all levels up to this energy eigenvalue. Only used when \_SCALAPACK is on.

\option{NumSolutions} [6] calculate the first \texttt{NumSolutions} eigenvalues of the Hamiltonian. To include all solutions (possibly many thousands) set to \code{0}.
% (when \texttt{CI/MaxEnergy} is not used).

\subsubsection{[CI/Output]: Configuration interaction display options.}

\option{Type} Sets the type of output the program should generate, Standard is the default, other options are CommaSeparated, TabSeparated or SpaceSeparated

\option{ShowgFactors} Determines if g-factors should be displayed in the final solutions or otherwise

\option{ShowPercentages} Determines if percentages for solutions with mixed configurations should be displayed or not

\option{NumLeadingConfigurations} Sets the maximal number of leading configurations for each solution the program should display

\option{MinimumDisplayedPercentage} The percentage threshold for displaying mixing, default is 1\%

\option{MaxDisplayedEnergy} The maximum energy to display when solving in Davidson method, in eV

%DR
\subsection{[DR]: Autoionization rates}

Calculate autoionization rates for levels:
\[
A_{\nu J} = 2\pi \sum_{j l} \left| \left< \nu JM \Big| \hat V \Big| \{i, \epsilon_{j l} \} JM \right> \right|^2
\]
where $\epsilon_{j l}$ is the continuum wave at the energy $\epsilon_\nu$. Note that $A_{\nu J}$ is independent of $M$.

\option{-{}-energy-grid} Create set of continuum wavefunctions along an energy grid, and for each compound level to calculate use the closest one.

\option{IonizationEnergy} Ionization energy relative to ground state energy, e.g. if the energy of the ground state is -10.4 (atomic units) and the ionization energy is  1.0 (i.e. 27.2 eV) then use \code{DR/IonizationEnergy = -9.4}.

\option{EnergyLimit} Only calculate autoionization rates for compound resonances with energy below this (relative to \code{DR/IonizationEnergy}).

\option{ContinuumLMax} [6] Maximum orbital angular momentum of continuum waves to include.

\option{ContinuumFieldConfiguration} Specify configuration of Hartree-Fock core in which to calculate continuum wavefunction, e.g. \code{'1s2 2s1'}. Default is Hartree-Fock core (including any open shells) specified in \code{HF/Configuration}.

\subsubsection{[DR/Target]: Specify target (with one fewer electron)}

\option{Filename} input file for target calculation. Must include CI and creation of target level.

\option{TwoJ} twice the angular momentum of the target level.

\option{Parity} specify parity of target level (either \code{even} or \code{odd}).

\option{Index} [0] specify level index of target.

\subsubsection{[DR/EnergyGrid] specify energy grid if \code{DR/-{}-energy-grid} is used}

\option{Min} [0.003675] minimum energy of continuum wave above ionization energy (default 0.1 eV)

\option{Max} [3.675] maximum energy of continuum wave above ionization energy (default 100 eV)

\option{Step} [0.03675] energy grid step size (default 1 eV)

\subsubsection{Configuration-averaged version}
If \texttt{-{}-configuration-average} is used, there is an alternative version that calculates the total strength for each dielectronic excitation from the target $a b h^{-1}$ (i.e. hole in $h$ and excitation to orbitals $a$ and $b$).
The formula is
\begin{multline}
\nonumber
S_\textsl{abh} = \pi \sum_{j l k} \big< a b \big\Vert \hat V^k \big\Vert \epsilon_{j l} h\big> 
	\left[ \frac{\big< a b \big\Vert \hat V^k \big\Vert \epsilon_{j l} h \big>}{2k+1}
	- \sum_{k'} (-1)^{k+k'+1} \left\{ \begin{array}{ccc} k & j_a & j_\epsilon \\ k' & j_b & j_h \end{array} \right\}
	\big< a b \big\Vert \hat V^k \big\Vert h \epsilon_{j l} \big> \right]\\
	\cdot \frac{n_h}{2 j_h + 1} \left(1 - \frac{n_a}{2 j_a + 1} \right) \left(1 - \frac{n_b}{2 j_b + 1} \right)
	+ \left< \textrm{swap}\ a \leftrightarrow b \right>
\end{multline}
where $n_h$, $n_a$, $n_b$ are target occupancies of the orbitals.
Connection with the level-resolved autoionization rate is made via
\[
S_\textsl{abh} \approx \sum_{\nu \in abh^{-1}} \sum_J \frac{2J_\nu + 1}{2 (2J_i + 1)} A_{\nu J} \ .
\]
Additional options for the configuration-averaged version:

\option{-{}-single-particle-energy} Print simple sum over HF energies $\epsilon_a + \epsilon_b - \epsilon_h$ rather than configuration-average energy.

\option{-{}-print-relativistic-difference} Print relativistic orbitals $a b h^{-1}$ rather than non-relativistic configuration.

\section{Multiple runs}

It is very useful to be able to perform multiple runs using the same basic setup except varying a single parameter throughout the process. To do this the user simply has to turn the varying parameter into a list. For example, to determine sensitivity to $\alpha$ ($q$-coefficients) one can use
\begin{quote}
\begin{verbatim}
AlphaSquaredVariation = '-0.25, -0.125, 0.0, 0.125, 0.25'
\end{verbatim}
\end{quote}
and the code will run five times exactly the same but varying $x = \alpha^2 - 1$. To make the code calculate a subset of these options in a given run, use the parameter \texttt{-r}. For example \texttt{-r = '1, 5'} will run the first and last only. \texttt{-r = 0} searches for the case where the varying parameter equals zero and runs that one only.

The user may additionally wish to vary \texttt{MBPT/Delta} for each of the runs. This is done using, for example
\begin{quote}
\begin{verbatim}
MBPT/Delta = '0.55, 0.56, 0.57, 0.58, 0.59'
\end{verbatim}
\end{quote}

The following options can be varied over multiple runs:
\option{NuclearInverseMass} used for calculating specific mass shift ($\sim 1/M$), see~\cite{berengut03pra,berengut05pra,berengut06pra}. Typical values are $-0.002 \rightarrow 0.002$.
\option{NuclearRadius} radius of the nucleus in fermi. The nuclear charge is distributed according to the Fermi distribution
\[
\rho(r) \sim \frac{1}{1 + e^{(r - C)/B}}
\]
where $C = \texttt{NuclearRadius}$ and $B = \texttt{NuclearThickness}/4\ln 3$.

\option{NuclearVolumeVariation} is used with \texttt{\textbf{DeltaNuclearRadius}} to provide an alternative method of calculating field shift~\cite{berengut03pra}. AMBiT will calculate the change in nuclear potential due to \texttt{DeltaNuclearRadius}: $\Delta U = U(R+\Delta R) - U(R)$ where $R$ is the nuclear radius. This can then be scaled using \texttt{NuclearVolumeVariation} $=\lambda$ and used in calculations as
\[
	U(r) = U_R(r) + \lambda\, \Delta U(r)\ .
\]

\option{AlphaSquaredVariation} (described above) varies $x = (\alpha/\alpha_0)^2-1$~\cite{dzuba99pra}.

\section{Recursive Builds}

Enable to perform an automated run, which increments N from a specified N (default is 1) until N = Z. It will automatically fill the next lowest available state while building the next atom. To avoid instability in the computation, N should not be too much smaller than Z.

\section{Interactive Mode}

Interactive mode, enabled with -{}-interactive, is provided for when the level structure of the atom being computed is not known in advance, yet one wishes to perform transition calculations based on the results. Interactive mode currently prints all the solutions in a short-hand format after the conclusion of the computation, assigning each solution level a unique identifier consisting of a number followed by 'e' or 'o' and then followed by a second number. The first number represents twice the total angular momentum J, 'e' is assigned to even parity states and 'o' to odd parity states, and the final number represents the position of the solution with that particular J and parity to all other solutions with the same J and parity. Entering the unique ID alone will cause AMBiT to print the information for that level again. To compute a transition, AMBiT accepts a solution ID followed by a dash (-), greater than sign (>) or both, followed by another solution ID. After computing the transition, it prints the result and stores the numbers in memory, so that the results can be recalled without additional computation. Interactive mode can be terminated with the input 'quit'.

\bibliographystyle{apsrev}
\bibliography{references}

\end{document}
